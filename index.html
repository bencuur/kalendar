import React, { useEffect, useState } from "react";
<div>
<h1 className="text-2xl font-semibold">Zdieľaný kalendár</h1>
<p className="text-sm text-gray-600">Mesiac: {viewDate.toLocaleString(undefined,{month:'long', year:'numeric'})}</p>
</div>
<div className="flex gap-2">
<button className="px-3 py-1 rounded shadow bg-white" onClick={prevMonth}>◀</button>
<button className="px-3 py-1 rounded shadow bg-white" onClick={goToday}>Dnes</button>
<button className="px-3 py-1 rounded shadow bg-white" onClick={nextMonth}>▶</button>
<button className="px-3 py-1 rounded shadow bg-indigo-600 text-white" onClick={()=>openNewModal(new Date().toISOString().slice(0,10))}>Pridať udalosť</button>
<button className="px-3 py-1 rounded shadow bg-white" onClick={copyShareLink}>Kopírovať link</button>
<button className="px-3 py-1 rounded shadow bg-white" onClick={exportICS}>Export .ics</button>
</div>
</header>


<div className="grid grid-cols-7 gap-1 text-sm">
{['Ne','Po','Ut','St','Št','Pia','So'].map(d=> (
<div key={d} className="text-center font-medium py-2">{d}</div>
))}
</div>


<div className="grid grid-cols-7 gap-1">
{monthGrid.map((date,i) => {
const inMonth = date.getMonth() === viewDate.getMonth();
const isToday = date.toDateString() === today.toDateString();
const dayEvents = eventsForDay(date);
return (
<div key={i} className={`border rounded p-2 min-h-[90px] ${inMonth ? 'bg-white' : 'bg-gray-50'} ${isToday ? 'ring-2 ring-indigo-200' : ''}`}>
<div className="flex justify-between items-start">
<div className={`text-xs font-medium ${inMonth ? '' : 'text-gray-400'}`}>{date.getDate()}</div>
<button className="text-[10px] px-2 py-0.5 bg-green-100 rounded" onClick={()=>openNewModal(date.toISOString().slice(0,10))}>+ pridať</button>
</div>
<div className="mt-1 space-y-1">
{dayEvents.slice(0,4).map(ev=> (
<div key={ev.id} className="p-1 rounded bg-indigo-50 cursor-pointer" onClick={()=>openEditModal(ev)}>
<div className="text-[11px] font-semibold truncate">{ev.title}</div>
<div className="text-[10px] text-gray-600">{new Date(ev.start).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
</div>
))}
{dayEvents.length > 4 && <div className="text-xs text-gray-500">+{dayEvents.length-4} ďalšie</div>}
</div>
</div>
);
})}
</div>


{/* Modal */}
{modalOpen && (
<div className="fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50">
<form onSubmit={saveEvent} className="bg-white rounded-lg w-full max-w-lg p-6 shadow-lg">
<h2 className="text-lg font-semibold mb-3">{editingEvent ? 'Upraviť udalosť' : 'Nová udalosť'}</h2>
<div className="grid grid-cols-2 gap-3">
<label className="flex flex-col">
<span className="text-xs text-gray-600">Názov</span>
<input value={form.title} onChange={e=>setForm({...form, title:e.target.value})} className="border rounded p-2" required />
</label>
<label className="flex flex-col">
<span className="text-xs text-gray-600">Dátum</span>
<input type="date" value={form.date} onChange={e=>setForm({...form, date:e.target.value})} className="border rounded p-2" required />
</label>
<label className="flex flex-col">
<span className="text-xs text-gray-600">Čas</span>
<input type="time" value={form.time} onChange={e=>setForm({...form, time:e.target.value})} className="border rounded p-2" required />
</label>
<label className="flex flex-col">
<span className="text-xs text-gray-600">Trvanie (min)</span>
<input type="number" min={1} value={form.duration} onChange={e=>setForm({...form, duration:e.target.value})} className="border rounded p-2" />
</label>
</div>
<label className="flex flex-col mt-3">
<span className="text-xs text-gray-600">Popis</span>
<textarea value={form.description} onChange={e=>setForm({...form, description:e.target.value})} className="border rounded p-2" rows={3} />
</label>
<label className="flex flex-col mt-3">
<span className="text-xs text-gray-600">Účastníci (oddelení čiarkou - emaily)</span>
<input value={form.attendees} onChange={e=>setForm({...form, attendees:e.target.value})} className="border rounded p-2" placeholder="ana@example.com, peter@example.com" />
</label>


<div className="flex justify-end gap-2 mt-4">
{editingEvent && <button type="button" onClick={()=>{ deleteEvent(editingEvent.id); setModalOpen(false); }} className="px-3 py-1 rounded bg-red-100">Vymazať</button>}
<button type="button" onClick={()=>setModalOpen(false)} className="px-4 py-2 rounded border">Zrušiť</button>
<button type="submit" className="px-4 py-2 rounded bg-indigo-600 text-white">Uložiť</button>
</div>
</form>
</div>
)}


{/* Small footer with share link preview */}
<footer className="mt-6 text-sm text-gray-600">
<div>Link pre zdieľanie (obsah kalendára bude zakódovaný v linku):</div>
<div className="mt-1 flex gap-2">
<input className="flex-1 border rounded p-2" readOnly value={makeShareLink()} />
<button className="px-3 py-1 rounded bg-white" onClick={copyShareLink}>Kopírovať</button>
</div>
</footer>
</div>
);
}
